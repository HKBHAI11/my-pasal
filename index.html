<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rahul Kirana — Order via WhatsApp</title>
<style>
  :root{--accent:#059669;--muted:#6b7280;--card:#fff}
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#f7fafc;color:#0b1220}
  header{background:linear-gradient(90deg,#ecfccb,#d1fae5);padding:14px 18px;display:flex;justify-content:space-between;align-items:center}
  h1{margin:0;font-size:18px}
  .container{max-width:980px;margin:18px auto;padding:0 12px}
  .grid{display:grid;grid-template-columns:1fr 320px;gap:16px}
  .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
  .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
  img{width:100%;height:140px;object-fit:cover;border-radius:8px}
  .price{font-weight:800;color:var(--accent)}
  button{background:var(--accent);color:white;border:none;padding:8px 10px;border-radius:8px;cursor:pointer}
  .btn-alt{background:transparent;border:1px solid rgba(5,150,105,0.12);color:var(--accent)}
  aside .card{position:sticky;top:18px}
  footer{padding:18px;text-align:center;color:var(--muted);font-size:13px;margin-top:18px}
  @media(max-width:880px){.grid{grid-template-columns:1fr}aside .card{position:static}}
  input,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6eef2;margin-top:6px}
  .small{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<header>
  <h1>Rahul Kirana — Order Online (WhatsApp)</h1>
  <div class="small">Customer orders → Direct WhatsApp to owner</div>
</header>

<main class="container">
  <div class="grid">
    <section>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <h2 style="margin:0">Products</h2>
        <input id="search" placeholder="Search items..." style="padding:8px;border-radius:8px;border:1px solid #e6eef2"/>
      </div>

      <div class="products" id="productList"></div>
    </section>

    <aside>
      <div class="card">
        <h3>Cart</h3>
        <div id="cartItems" style="display:flex;flex-direction:column;gap:8px;margin-top:8px"></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
          <div class="small">Total:</div>
          <div id="totalAmt" style="font-weight:800">₹0</div>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #f1f5f9"/>

        <div>
          <label>Naam<input id="custName" placeholder="Aapka naam" /></label>
          <label>Phone<input id="custPhone" placeholder="98XXXXXXXX" /></label>
          <label>Address<textarea id="custAddr" rows="2" placeholder="Ghar ka address / landmark"></textarea></label>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="locBtn" class="btn-alt" style="flex:1">Get location</button>
            <button id="orderBtn" style="flex:1">Order via WhatsApp</button>
          </div>
          <div id="locStatus" class="small" style="margin-top:8px">Location: not set</div>
        </div>

        <p class="small" style="margin-top:10px">Tip: Customer ko location allow karne ko bolein — tab aapko exact map link milega.</p>
      </div>
    </aside>
  </div>
</main>

<footer>Demo: Orders come to WhatsApp. For secure production, add backend, DB, and payment integration.</footer>

<script>
/* ====== CONFIG: set your WhatsApp phone number here (country code + number, no + or 00) ====== */
/* Example nepal: '9779805319706' */
const sellerWhatsApp = '9779806319705'; // <-- change this to your WhatsApp number

/* ====== Demo product list (edit or replace) ====== */
const defaultProducts = [
  {id:'g1',title:'chini (1kg)',price:100,img:'https://via.placeholder.com/400x300?text=chini+1kg'},
  {id:'g2',title:'Chawal (5kg)',price:420,img:'https://via.placeholder.com/400x300?text=Chawal+5kg'},
  {id:'g3',title:'Tel (1L)',price:180,img:'https://via.placeholder.com/400x300?text=Tel+1L'},
  {id:'g4',title:'Daal (1kg)',price:120,img:'https://via.placeholder.com/400x300?text=Daal+1kg'},
  {id:'g5',title:'Sugar (1kg)',price:55,img:'https://via.placeholder.com/400x300?text=Sugar+1kg'}
];

const KEY_PRODUCTS='rk_products_v1';
if(!localStorage.getItem(KEY_PRODUCTS)) localStorage.setItem(KEY_PRODUCTS,JSON.stringify(defaultProducts));

/* ====== Helper functions ====== */
function loadProducts(){ try{ return JSON.parse(localStorage.getItem(KEY_PRODUCTS)) } catch(e){ return defaultProducts } }
function saveProducts(arr){ localStorage.setItem(KEY_PRODUCTS,JSON.stringify(arr)) }

const productListEl = document.getElementById('productList');
const cartItemsEl = document.getElementById('cartItems');
const totalAmtEl = document.getElementById('totalAmt');
const searchEl = document.getElementById('search');

let cart = JSON.parse(localStorage.getItem('rk_cart_v1')||'[]');
let userLocation = null; // {lat, lng}

/* Render products */
function renderProducts(filter=''){
  const prods = loadProducts();
  productListEl.innerHTML='';
  const q = filter.trim().toLowerCase();
  prods.filter(p=>p.title.toLowerCase().includes(q) || (p.desc||'').toLowerCase().includes(q)).forEach(p=>{
    const c = document.createElement('div'); c.className='card';
    c.innerHTML = `
      <img src="${p.img}" alt="${p.title}" onerror="this.src='https://via.placeholder.com/400x300?text=Image'">
      <h4 style="margin:8px 0 4px 0">${p.title}</h4>
      <div class="small">${p.desc||''}</div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
        <div class="price">₹${Number(p.price).toLocaleString()}</div>
        <div style="display:flex;gap:6px">
          <button onclick="addQty('${p.id}',1)">+</button>
          <button class="btn-alt" onclick="addToCart('${p.id}')">Add</button>
        </div>
      </div>
    `;
    productListEl.appendChild(c);
  });
}

/* Cart functions */
function saveCart(){ localStorage.setItem('rk_cart_v1', JSON.stringify(cart)); }
function addToCart(id){
  const prods = loadProducts(); const p = prods.find(x=>x.id===id); if(!p) return;
  const it = cart.find(x=>x.id===id);
  if(it){ it.qty++; } else { cart.push({id:p.id,title:p.title,price:Number(p.price),qty:1}) }
  saveCart(); renderCart();
}
function addQty(id,delta){
  const it = cart.find(x=>x.id===id);
  if(it){ it.qty = Math.max(0, it.qty + delta); if(it.qty===0) cart = cart.filter(x=>x.id!==id); saveCart(); renderCart(); }
}
function renderCart(){
  cartItemsEl.innerHTML='';
  let total = 0;
  if(cart.length===0){ cartItemsEl.innerHTML='<div class="small">Cart khaali hai</div>'; totalAmtEl.textContent='₹0'; return; }
  cart.forEach(i=>{
    total += i.price * i.qty;
    const row = document.createElement('div'); row.style.display='flex';row.style.justifyContent='space-between';row.style.alignItems='center';
    row.innerHTML = `<div><div style="font-weight:700">${i.title}</div><div class="small">Qty: ${i.qty} — ₹${(i.price*i.qty).toLocaleString()}</div></div>
      <div style="display:flex;flex-direction:column;gap:6px">
        <div>
          <button onclick="addQty('${i.id}',-1)" style="margin-right:6px">−</button>
          <button onclick="addQty('${i.id}',1)">+</button>
        </div>
      </div>`;
    cartItemsEl.appendChild(row);
  });
  totalAmtEl.textContent = '₹' + total.toLocaleString();
}

/* Search */
searchEl.addEventListener('input',e=>renderProducts(e.target.value));

/* Location: use browser geolocation */
const locBtn = document.getElementById('locBtn');
const locStatus = document.getElementById('locStatus');
locBtn.addEventListener('click', ()=>{
  if(!navigator.geolocation){ locStatus.textContent='Geolocation unsupported in this browser.'; return; }
  locStatus.textContent='Requesting location...';
  navigator.geolocation.getCurrentPosition(pos=>{
    userLocation = {lat:pos.coords.latitude, lng:pos.coords.longitude};
    locStatus.textContent = `Location set: ${userLocation.lat.toFixed(5)}, ${userLocation.lng.toFixed(5)}`;
  }, err=>{
    locStatus.textContent = 'Location denied or error. Please enter address manually.';
  }, {enableHighAccuracy:true, timeout:15000});
});

/* Order via WhatsApp */
const orderBtn = document.getElementById('orderBtn');
orderBtn.addEventListener('click', ()=>{
  if(!sellerWhatsApp || sellerWhatsApp.includes('PLACE_YOUR')){ alert('Owner: apna WhatsApp number code me set karein (sellerWhatsApp variable).'); return; }
  const name = document.getElementById('custName').value.trim();
  const phone = document.getElementById('custPhone').value.trim();
  const addr = document.getElementById('custAddr').value.trim();
  if(!name || !phone){ alert('Kripya apna naam aur phone number daalein.'); return; }
  if(cart.length===0){ alert('Cart khaali hai — pehle items add karein.'); return; }

  // build order summary
  let total = 0;
  let lines = [];
  cart.forEach(i=>{
    total += i.price * i.qty;
    lines.push(`${i.title} x${i.qty} = ₹${(i.price*i.qty).toLocaleString()}`);
  });
  // location map link
  let mapPart = '';
  if(userLocation){ mapPart = `\nMap: https://www.google.com/maps/search/?api=1&query=${userLocation.lat},${userLocation.lng}`; }
  // full message
  const msg = `नया ऑर्डर%0Aनाम: ${encodeURIComponent(name)}%0Aफोन: ${encodeURIComponent(phone)}%0Aपता: ${encodeURIComponent(addr)}%0A%0Aआइटम्स:%0A${encodeURIComponent(lines.join('%0A'))}%0A%0Aकुल: ₹${total.toLocaleString()}${userLocation?('%0A%0AMap:%0A' + encodeURIComponent('https://www.google.com/maps/search/?api=1&query=' + userLocation.lat + ',' + userLocation.lng)) : ''}%0A%0A(यह ऑर्डर ग्राहक वेबसाइट से भेजा गया)`;

  // WhatsApp link
  const waLink = `https://api.whatsapp.com/send?phone=${sellerWhatsApp}&text=${msg}`;
  // open in new tab
  window.open(waLink, '_blank');
});

/* init */
renderProducts(); renderCart();

</script>
</body>
</html>